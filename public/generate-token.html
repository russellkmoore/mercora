<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Token Generator</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .checkbox-group { display: flex; flex-direction: column; gap: 8px; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; }
        .checkbox-item input { width: auto; }
        button { background: #f97316; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #ea580c; }
        .result { margin-top: 20px; padding: 15px; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 4px; }
        .token { background: #1f2937; color: #10b981; padding: 10px; border-radius: 4px; font-family: monospace; word-break: break-all; margin: 10px 0; }
        .warning { background: #fef3c7; color: #92400e; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .error { background: #fee2e2; color: #dc2626; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîë API Token Generator</h1>
    <p><strong>Temporary tool</strong> - Delete this after creating your tokens!</p>
    
    <form id="tokenForm">
        <div class="form-group">
            <label for="name">Token Name:</label>
            <input type="text" id="name" name="name" required placeholder="e.g., admin-panel-token">
        </div>

        <div class="form-group">
            <label>Permissions:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="orders-read" value="orders:read">
                    <label for="orders-read">orders:read - View orders</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="orders-write" value="orders:write">
                    <label for="orders-write">orders:write - Create/modify orders</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="orders-update" value="orders:update_status">
                    <label for="orders-update">orders:update_status - Update order status</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="vectorize-read" value="vectorize:read">
                    <label for="vectorize-read">vectorize:read - Read vectorize data</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="vectorize-write" value="vectorize:write">
                    <label for="vectorize-write">vectorize:write - Write vectorize data</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="webhooks-receive" value="webhooks:receive">
                    <label for="webhooks-receive">webhooks:receive - Receive webhooks</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="admin-all" value="admin:*">
                    <label for="admin-all">admin:* - All admin permissions</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="expiresAt">Expires At (optional):</label>
            <input type="datetime-local" id="expiresAt" name="expiresAt">
        </div>

        <button type="submit">Generate Token</button>
    </form>

    <div id="result"></div>

    <h2>üöÄ Quick Setup Tokens</h2>
    <p>Common token configurations:</p>
    
    <button type="button" onclick="createOrderManagementToken()">
        üì¶ Order Management Token
    </button>
    <button type="button" onclick="createVectorizeToken()">
        üîç Vectorize API Token
    </button>
    <button type="button" onclick="createAdminToken()">
        üëë Full Admin Token
    </button>

    <script>
        document.getElementById('tokenForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const name = formData.get('name');
            const expiresAt = formData.get('expiresAt');
            
            const permissions = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                permissions.push(cb.value);
            });

            if (permissions.length === 0) {
                showError('Please select at least one permission.');
                return;
            }

            try {
                const response = await fetch('/api/admin/generate-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name,
                        permissions,
                        expiresAt: expiresAt || undefined,
                    }),
                });

                const data = await response.json();

                if (data.success) {
                    showResult(data);
                } else {
                    showError(data.error || 'Failed to generate token');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        });

        function showResult(data) {
            document.getElementById('result').innerHTML = `
                <div class="result">
                    <h3>‚úÖ Token Generated Successfully!</h3>
                    <div class="warning">
                        ‚ö†Ô∏è <strong>Save this token now!</strong> It won't be shown again.
                    </div>
                    <div class="token">${data.token}</div>
                    <p><strong>Name:</strong> ${data.message.split("'")[1]}</p>
                    <p><strong>Permissions:</strong> ${data.permissions.join(', ')}</p>
                    
                    <h4>Usage Examples:</h4>
                    <pre style="background: #f3f4f6; padding: 10px; border-radius: 4px; overflow-x: auto;">
# Using Authorization header
curl -H "Authorization: Bearer ${data.token}" https://your-domain.com/api/update-order

# Using X-API-Key header  
curl -H "X-API-Key: ${data.token}" https://your-domain.com/api/update-order

# Using query parameter
curl "https://your-domain.com/api/update-order?token=${data.token}"</pre>
                </div>
            `;
        }

        function showError(error) {
            document.getElementById('result').innerHTML = `
                <div class="error">
                    <h3>‚ùå Error</h3>
                    <p>${error}</p>
                </div>
            `;
        }

        function setPermissions(permissions) {
            // Clear all checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Check specified permissions
            permissions.forEach(perm => {
                const checkbox = document.querySelector(`input[value="${perm}"]`);
                if (checkbox) checkbox.checked = true;
            });
        }

        function createOrderManagementToken() {
            document.getElementById('name').value = 'order-management-token';
            setPermissions(['orders:read', 'orders:write', 'orders:update_status']);
        }

        function createVectorizeToken() {
            document.getElementById('name').value = 'vectorize-api-token';
            setPermissions(['vectorize:read', 'vectorize:write']);
        }

        function createAdminToken() {
            document.getElementById('name').value = 'admin-token';
            setPermissions(['admin:*']);
        }
    </script>
</body>
</html>
